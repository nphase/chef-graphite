[cache]
LOG_UPDATES = False
MAX_CACHE_SIZE = inf
MAX_UPDATES_PER_SECOND = 1000
MAX_CREATES_PER_MINUTE = 50
USE_FLOW_CONTROL = True
USER = <%= @user %>
WHISPER_AUTOFLUSH = False

<%- default_cache = @caches.find { |i| i.name == 'None' } -%>
LINE_RECEIVER_INTERFACE = <%= default_cache.listen_on %>
LINE_RECEIVER_PORT = <%= default_cache.port %>
PICKLE_RECEIVER_INTERFACE = <%= default_cache.listen_on %>
PICKLE_RECEIVER_PORT = <%= default_cache.pickle_port %>
CACHE_QUERY_INTERFACE = <%= default_cache.listen_on %>
CACHE_QUERY_PORT = <%= default_cache.query_port %>

<%- other_caches = @caches.reject { |i| i.name == 'None' } -%>
<%- other_caches.each do |oc| -%>
[cache:<%= oc.name %>]
LINE_RECEIVER_INTERFACE = <%= oc.listen_on %>
LINE_RECEIVER_PORT = <%= oc.port %>
PICKLE_RECEIVER_INTERFACE = <%= oc.listen_on %>
PICKLE_RECEIVER_PORT = <%= oc.pickle_port %>
CACHE_QUERY_INTERFACE = <%= oc.listen_on %>
CACHE_QUERY_PORT = <%= oc.query_port %>
<%- end -%>

[relay]
MAX_DATAPOINTS_PER_MESSAGE = 500
MAX_QUEUE_SIZE = 10000
RELAY_METHOD = rules
REPLICATION_FACTOR = 1
USE_FLOW_CONTROL = True

<%- unless @relays.empty? -%>
  <%- @relays.each do |relay| -%>
[relay:<%= relay.name %>]
LINE_RECEIVER_INTERFACE = <%= relay.listen_on %>
LINE_RECEIVER_PORT = <%= relay.port %>
PICKLE_RECEIVER_INTERFACE = <%= relay.listen_on %>
PICKLE_RECEIVER_PORT = <%= relay.pickle_port %>
  <%- end -%>

DESTINATIONS = <%= caches.each { |c| "#{ c.listen_on }:#{ c.pickle_port }:#{ c.name }" }.join(', ') %>
<%- end -%>
